<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Active Record Validations — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbo-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbo-track="reload">
  
  <link rel="icon" href="images/favicon.ico" sizes="any">
  <link rel="icon" href="images/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="images/icon.png">
  
  <script src="javascripts/@hotwired--turbo.js" data-turbo-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbo-track="reload"></script>
  <script src="javascripts/guides.js" data-turbo-track="reload"></script>

  <meta property="og:title" content="Active Record Validations — Ruby on Rails Guides" />
  <meta name="description" content="Active Record ValidationsThis guide teaches you how to validate the state of objects before they go into the database using Active Record&#39;s validations feature.After reading this guide, you will know: How to use the built-in Active Record validation helpers. How to create your own custom validation methods. How to work with the error messages generated by the validation process." />
  <meta property="og:description" content="Active Record ValidationsThis guide teaches you how to validate the state of objects before they go into the database using Active Record&#39;s validations feature.After reading this guide, you will know: How to use the built-in Active Record validation helpers. How to create your own custom validation methods. How to work with the error messages generated by the validation process." />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />

  <meta name="theme-color" content="#C81418">
</head>

<body dir="ltr" class="guide">
  <div>
    <div id="version-badge">edge</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More at <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        More Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://rubyonrails.org/blog">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guides</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribute on GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <div class="header-logo"><a href="index.html" title="Return to home page">Guides.rubyonrails.org</a></div>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guides Index</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Start Here</dt>
                  <dd><a href="getting_started.html">Getting Started with Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Other Components</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Digging Deeper</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="error_reporting.html">Error Reporting in Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading</a></dd>
                  <dd><a href="classic_to_zeitwerk_howto.html">Migrating from Classic to Zeitwerk</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases</a></dd>
                  <dd><a href="active_record_composite_primary_keys.html">Composite Primary Keys</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Extending Rails</dt>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contributing</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Guides Guidelines</a></dd>
                  <dd><a href="development_dependencies_install.html">Installing Rails Core Development Dependencies</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Policies</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="7_1_release_notes.html">Version 7.1 - October 2023</a></dd>
                  <dd><a href="7_0_release_notes.html">Version 7.0 - December 2021</a></dd>
                  <dd><a href="6_1_release_notes.html">Version 6.1 - December 2020</a></dd>
                  <dd><a href="6_0_release_notes.html">Version 6.0 - August 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribute</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guides Index</option>
              <optgroup label="Start Here">
                  <option value="getting_started.html">Getting Started with Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Other Components">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
              </optgroup>
              <optgroup label="Digging Deeper">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="error_reporting.html">Error Reporting in Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading</option>
                  <option value="classic_to_zeitwerk_howto.html">Migrating from Classic to Zeitwerk</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases</option>
                  <option value="active_record_composite_primary_keys.html">Composite Primary Keys</option>
              </optgroup>
              <optgroup label="Extending Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
              </optgroup>
              <optgroup label="Contributing">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Guides Guidelines</option>
                  <option value="development_dependencies_install.html">Installing Rails Core Development Dependencies</option>
              </optgroup>
              <optgroup label="Policies">
                  <option value="maintenance_policy.html">Maintenance Policy</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="7_1_release_notes.html">Version 7.1 - October 2023</option>
                  <option value="7_0_release_notes.html">Version 7.0 - December 2021</option>
                  <option value="6_1_release_notes.html">Version 6.1 - December 2020</option>
                  <option value="6_0_release_notes.html">Version 6.0 - August 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h1>Active Record Validations</h1><p>This guide teaches you how to validate the state of objects before they go into
the database using Active Record&#39;s validations feature.</p><p>After reading this guide, you will know:</p>
<ul>
<li>How to use the built-in Active Record validation helpers.</li>
<li>How to create your own custom validation methods.</li>
<li>How to work with the error messages generated by the validation process.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/icon_book-close-bookmark-1.svg" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#validations-overview">Validations Overview</a>

<ul>
<li><a href="#why-use-validations-questionmark">Why Use Validations?</a></li>
<li><a href="#when-does-validation-happen-questionmark">When Does Validation Happen?</a></li>
<li><a href="#skipping-validations">Skipping Validations</a></li>
<li><a href="#valid-questionmark-and-invalid-questionmark"><code>valid?</code> and <code>invalid?</code></a></li>
<li><a href="#validations-overview-errors"><code>errors[]</code></a></li>
</ul></li>
<li><a href="#validation-helpers">Validation Helpers</a>

<ul>
<li><a href="#acceptance"><code>acceptance</code></a></li>
<li><a href="#confirmation"><code>confirmation</code></a></li>
<li><a href="#comparison"><code>comparison</code></a></li>
<li><a href="#format"><code>format</code></a></li>
<li><a href="#inclusion"><code>inclusion</code></a></li>
<li><a href="#exclusion"><code>exclusion</code></a></li>
<li><a href="#length"><code>length</code></a></li>
<li><a href="#numericality"><code>numericality</code></a></li>
<li><a href="#presence"><code>presence</code></a></li>
<li><a href="#absence"><code>absence</code></a></li>
<li><a href="#uniqueness"><code>uniqueness</code></a></li>
<li><a href="#validates-associated"><code>validates_associated</code></a></li>
<li><a href="#validates-each"><code>validates_each</code></a></li>
<li><a href="#validates-with"><code>validates_with</code></a></li>
</ul></li>
<li><a href="#common-validation-options">Common Validation Options</a>

<ul>
<li><a href="#allow-nil"><code>:allow_nil</code></a></li>
<li><a href="#allow-blank"><code>:allow_blank</code></a></li>
<li><a href="#message"><code>:message</code></a></li>
<li><a href="#on"><code>:on</code></a></li>
</ul></li>
<li><a href="#strict-validations">Strict Validations</a></li>
<li><a href="#conditional-validation">Conditional Validation</a>

<ul>
<li><a href="#using-a-symbol-with-if-and-unless">Using a Symbol with <code>:if</code> and <code>:unless</code></a></li>
<li><a href="#using-a-proc-with-if-and-unless">Using a Proc with <code>:if</code> and <code>:unless</code></a></li>
<li><a href="#grouping-conditional-validations">Grouping Conditional Validations</a></li>
<li><a href="#combining-validation-conditions">Combining Validation Conditions</a></li>
</ul></li>
<li><a href="#performing-custom-validations">Performing Custom Validations</a>

<ul>
<li><a href="#custom-validators">Custom Validators</a></li>
<li><a href="#custom-methods">Custom Methods</a></li>
<li><a href="#listing-validators">Listing Validators</a></li>
</ul></li>
<li><a href="#working-with-validation-errors">Working with Validation Errors</a>

<ul>
<li><a href="#working-with-validation-errors-errors"><code>errors</code></a></li>
<li><a href="#errors"><code>errors[]</code></a></li>
<li><a href="#errors-where-and-error-object"><code>errors.where</code> and Error Object</a></li>
<li><a href="#errors-add"><code>errors.add</code></a></li>
<li><a href="#errors-base"><code>errors[:base]</code></a></li>
<li><a href="#errors-size"><code>errors.size</code></a></li>
<li><a href="#errors-clear"><code>errors.clear</code></a></li>
</ul></li>
<li><a href="#displaying-validation-errors-in-views">Displaying Validation Errors in Views</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h2 id="validations-overview"><a class="anchorlink" href="#validations-overview">1 Validations Overview</a></h2><p>Here's an example of a very simple validation:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Person.create(name: &quot;John Doe&quot;).valid?
Person.create(name: nil).valid?
">Copy</button>
</div>
<p>As you can see, our validation lets us know that our <code>Person</code> is not valid
without a <code>name</code> attribute. The second <code>Person</code> will not be persisted to the
database.</p><p>Before we dig into more details, let's talk about how validations fit into the
big picture of your application.</p><h3 id="why-use-validations-questionmark"><a class="anchorlink" href="#why-use-validations-questionmark">1.1 Why Use Validations?</a></h3><p>Validations are used to ensure that only valid data is saved into your
database. For example, it may be important to your application to ensure that
every user provides a valid email address and mailing address. Model-level
validations are the best way to ensure that only valid data is saved into your
database. They are database agnostic, cannot be bypassed by end users, and are
convenient to test and maintain. Rails provides built-in helpers for common
needs, and allows you to create your own validation methods as well.</p><p>There are several other ways to validate data before it is saved into your
database, including native database constraints, client-side validations and
controller-level validations. Here's a summary of the pros and cons:</p>
<ul>
<li>Database constraints and/or stored procedures make the validation mechanisms
database-dependent and can make testing and maintenance more difficult.
However, if your database is used by other applications, it may be a good
idea to use some constraints at the database level. Additionally,
database-level validations can safely handle some things (such as uniqueness
in heavily-used tables) that can be difficult to implement otherwise.</li>
<li>Client-side validations can be useful, but are generally unreliable if used
alone. If they are implemented using JavaScript, they may be bypassed if
JavaScript is turned off in the user's browser. However, if combined with
other techniques, client-side validation can be a convenient way to provide
users with immediate feedback as they use your site.</li>
<li>Controller-level validations can be tempting to use, but often become
unwieldy and difficult to test and maintain. Whenever possible, it's a good
idea to keep your controllers simple, as it will make your
application a pleasure to work with in the long run.</li>
</ul>
<p>Choose these in certain, specific cases. It's the opinion of the Rails team
that model-level validations are the most appropriate in most circumstances.</p><h3 id="when-does-validation-happen-questionmark"><a class="anchorlink" href="#when-does-validation-happen-questionmark">1.2 When Does Validation Happen?</a></h3><p>There are two kinds of Active Record objects: those that correspond to a row
inside your database and those that do not. When you create a fresh object, for
example using the <code>new</code> method, that object does not belong to the database
yet. Once you call <code>save</code> upon that object it will be saved into the
appropriate database table. Active Record uses the <code>new_record?</code> instance
method to determine whether an object is already in the database or not.
Consider the following Active Record class:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
end
">Copy</button>
</div>
<p>We can see how it works by looking at some <code>bin/rails console</code> output:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="kp">nil</span><span class="kt">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">new_record?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">save</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">new_record?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="p = Person.new(name: &quot;John Doe&quot;)
p.new_record?
p.save
p.new_record?
">Copy</button>
</div>
<p>Creating and saving a new record will send an SQL <code>INSERT</code> operation to the
database. Updating an existing record will send an SQL <code>UPDATE</code> operation
instead. Validations are typically run before these commands are sent to the
database. If any validations fail, the object will be marked as invalid and
Active Record will not perform the <code>INSERT</code> or <code>UPDATE</code> operation. This avoids
storing an invalid object in the database. You can choose to have specific
validations run when an object is created, saved, or updated.</p><div class="warning"><p>There are many ways to change the state of an object in the database.
Some methods will trigger validations, but some will not. This means that it's
possible to save an object in the database in an invalid state if you aren't
careful.</p></div><p>The following methods trigger validations, and will save the object to the
database only if the object is valid:</p>
<ul>
<li><code>create</code></li>
<li><code>create!</code></li>
<li><code>save</code></li>
<li><code>save!</code></li>
<li><code>update</code></li>
<li><code>update!</code></li>
</ul>
<p>The bang versions (e.g. <code>save!</code>) raise an exception if the record is invalid.
The non-bang versions don't: <code>save</code> and <code>update</code> return <code>false</code>, and
<code>create</code> returns the object.</p><h3 id="skipping-validations"><a class="anchorlink" href="#skipping-validations">1.3 Skipping Validations</a></h3><p>The following methods skip validations, and will save the object to the
database regardless of its validity. They should be used with caution.</p>
<ul>
<li><code>decrement!</code></li>
<li><code>decrement_counter</code></li>
<li><code>increment!</code></li>
<li><code>increment_counter</code></li>
<li><code>insert</code></li>
<li><code>insert!</code></li>
<li><code>insert_all</code></li>
<li><code>insert_all!</code></li>
<li><code>toggle!</code></li>
<li><code>touch</code></li>
<li><code>touch_all</code></li>
<li><code>update_all</code></li>
<li><code>update_attribute</code></li>
<li><code>update_column</code></li>
<li><code>update_columns</code></li>
<li><code>update_counters</code></li>
<li><code>upsert</code></li>
<li><code>upsert_all</code></li>
</ul>
<p>Note that <code>save</code> also has the ability to skip validations if passed <code>validate:
false</code> as an argument. This technique should be used with caution.</p>
<ul>
<li><code>save(validate: false)</code></li>
</ul>
<h3 id="valid-questionmark-and-invalid-questionmark"><a class="anchorlink" href="#valid-questionmark-and-invalid-questionmark">1.4 <code>valid?</code> and <code>invalid?</code></a></h3><p>Before saving an Active Record object, Rails runs your validations.
If these validations produce any errors, Rails does not save the object.</p><p>You can also run these validations on your own. <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Validations.html#method-i-valid-3F"><code>valid?</code></a> triggers your validations
and returns true if no errors were found in the object, and false otherwise.
As you saw above:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">name: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Person.create(name: &quot;John Doe&quot;).valid?
Person.create(name: nil).valid?
">Copy</button>
</div>
<p>After Active Record has performed validations, any failures can be accessed
through the <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations.html#method-i-errors"><code>errors</code></a> instance method, which returns a collection of errors.
By definition, an object is valid if this collection is empty after running
validations.</p><p>Note that an object instantiated with <code>new</code> will not report errors
even if it's technically invalid, because validations are automatically run
only when the object is saved, such as with the <code>create</code> or <code>save</code> methods.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="kp">nil</span><span class="kt">&gt;</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">size</span>
<span class="p">=&gt;</span> <span class="mi">0</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">objects</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name can't be blank"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">create</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="kp">nil</span><span class="kt">&gt;</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">objects</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name can't be blank"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">save</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">p</span><span class="p">.</span><span class="nf">save!</span>
<span class="go">ActiveRecord::RecordInvalid: Validation failed: Name can't be blank
</span><span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create!</span>
<span class="go">ActiveRecord::RecordInvalid: Validation failed: Name can't be blank
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="p = Person.new
p.errors.size
p.valid?
p.errors.objects.first.full_message
p = Person.create
p.errors.objects.first.full_message
p.save
p.save!
Person.create!
">Copy</button>
</div>
<p><a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations.html#method-i-invalid-3F"><code>invalid?</code></a> is the inverse of <code>valid?</code>. It triggers your validations,
returning true if any errors were found in the object, and false otherwise.</p><h3 id="validations-overview-errors"><a class="anchorlink" href="#validations-overview-errors">1.5 <code>errors[]</code></a></h3><p>To verify whether or not a particular attribute of an object is valid, you can
use <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-5B-5D"><code>errors[:attribute]</code></a>. It returns an array of all
the error messages for <code>:attribute</code>. If there are no errors on the specified
attribute, an empty array is returned.</p><p>This method is only useful <em>after</em> validations have been run, because it only
inspects the errors collection and does not trigger validations itself. It's
different from the <code>ActiveRecord::Base#invalid?</code> method explained above because
it doesn't verify the validity of the object as a whole. It only checks to see
whether there are errors found on an individual attribute of the object.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">any?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">create</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">any?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Person.new.errors[:name].any?
Person.create.errors[:name].any?
">Copy</button>
</div>
<p>We'll cover validation errors in greater depth in the <a href="#working-with-validation-errors">Working with Validation
Errors</a> section.</p><h2 id="validation-helpers"><a class="anchorlink" href="#validation-helpers">2 Validation Helpers</a></h2><p>Active Record offers many pre-defined validation helpers that you can use
directly inside your class definitions. These helpers provide common validation
rules. Every time a validation fails, an error is added to the object's <code>errors</code>
collection, and this is associated with the attribute being validated.</p><p>Each helper accepts an arbitrary number of attribute names, so with a single
line of code you can add the same kind of validation to several attributes.</p><p>All of them accept the <code>:on</code> and <code>:message</code> options, which define when the
validation should be run and what message should be added to the <code>errors</code>
collection if it fails, respectively. The <code>:on</code> option takes one of the values
<code>:create</code> or <code>:update</code>. There is a default error message for each one of the
validation helpers. These messages are used when the <code>:message</code> option isn't
specified. Let's take a look at each one of the available helpers.</p><div class="info"><p>To see a list of the available default helpers, take a look at
<a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations/HelperMethods.html"><code>ActiveModel::Validations::HelperMethods</code></a>.</p></div><h3 id="acceptance"><a class="anchorlink" href="#acceptance">2.1 <code>acceptance</code></a></h3><p>This method validates that a checkbox on the user interface was checked when a
form was submitted. This is typically used when the user needs to agree to your
application's terms of service, confirm that some text is read, or any similar
concept.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:terms_of_service</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :terms_of_service, acceptance: true
end
">Copy</button>
</div>
<p>This check is performed only if <code>terms_of_service</code> is not <code>nil</code>.
The default error message for this helper is <em>"must be accepted"</em>.
You can also pass in a custom message via the <code>message</code> option.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:terms_of_service</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="p">{</span> <span class="ss">message: </span><span class="s1">'must be abided'</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :terms_of_service, acceptance: { message: 'must be abided' }
end
">Copy</button>
</div>
<p>It can also receive an <code>:accept</code> option, which determines the allowed values
that will be considered as acceptable. It defaults to <code>['1', true]</code> and can be
easily changed.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:terms_of_service</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="p">{</span> <span class="ss">accept: </span><span class="s1">'yes'</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:eula</span><span class="p">,</span> <span class="ss">acceptance: </span><span class="p">{</span> <span class="ss">accept: </span><span class="p">[</span><span class="s1">'TRUE'</span><span class="p">,</span> <span class="s1">'accepted'</span><span class="p">]</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :terms_of_service, acceptance: { accept: 'yes' }
  validates :eula, acceptance: { accept: ['TRUE', 'accepted'] }
end
">Copy</button>
</div>
<p>This validation is very specific to web applications and this 'acceptance' does
not need to be recorded anywhere in your database. If you don't have a field for
it, the helper will create a virtual attribute. If the field does exist in your
database, the <code>accept</code> option must be set to or include <code>true</code> or else the
validation will not run.</p><h3 id="confirmation"><a class="anchorlink" href="#confirmation">2.2 <code>confirmation</code></a></h3><p>You should use this helper when you have two text fields that should receive
exactly the same content. For example, you may want to confirm an email address
or a password. This validation creates a virtual attribute whose name is the
name of the field that has to be confirmed with "_confirmation" appended.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :email, confirmation: true
end
">Copy</button>
</div>
<p>In your view template you could use something like</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">text_field</span> <span class="ss">:person</span><span class="p">,</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">text_field</span> <span class="ss">:person</span><span class="p">,</span> <span class="ss">:email_confirmation</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="<%= text_field :person, :email %>
<%= text_field :person, :email_confirmation %>
">Copy</button>
</div>
<div class="note"><p>This check is performed only if <code>email_confirmation</code> is not <code>nil</code>. To require
confirmation, make sure to add a presence check for the confirmation attribute
(we'll take a look at <code>presence</code> <a href="#presence">later</a> on in this guide):</p></div><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:email_confirmation</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :email, confirmation: true
  validates :email_confirmation, presence: true
end
">Copy</button>
</div>
<p>There is also a <code>:case_sensitive</code> option that you can use to define whether the
confirmation constraint will be case sensitive or not. This option defaults to
true.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="p">{</span> <span class="ss">case_sensitive: </span><span class="kp">false</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :email, confirmation: { case_sensitive: false }
end
">Copy</button>
</div>
<p>The default error message for this helper is <em>"doesn't match confirmation"</em>.
You can also pass in a custom message via the <code>message</code> option.</p><p>Generally when using this validator, you will want to combine it with the <code>:if</code>
option to only validate the "_confirmation" field when the initial field has
changed and <strong>not</strong> every time you save the record. More on <a href="#conditional-validation">conditional
validations</a> later.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:email_confirmation</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">if: :email_changed?</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :email, confirmation: true
  validates :email_confirmation, presence: true, if: :email_changed?
end
">Copy</button>
</div>
<h3 id="comparison"><a class="anchorlink" href="#comparison">2.3 <code>comparison</code></a></h3><p>This check will validate a comparison between any two comparable values.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Promotion</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:end_date</span><span class="p">,</span> <span class="ss">comparison: </span><span class="p">{</span> <span class="ss">greater_than: :start_date</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Promotion < ApplicationRecord
  validates :end_date, comparison: { greater_than: :start_date }
end
">Copy</button>
</div>
<p>The default error message for this helper is <em>"failed comparison"</em>.
You can also pass in a custom message via the <code>message</code> option.</p><p>These options are all supported:</p>
<ul>
<li><code>:greater_than</code> - Specifies the value must be greater than the supplied
value. The default error message for this option is <em>"must be greater than
%{count}"</em>.</li>
<li><code>:greater_than_or_equal_to</code> - Specifies the value must be greater than or
equal to the supplied value. The default error message for this option is
<em>"must be greater than or equal to %{count}"</em>.</li>
<li><code>:equal_to</code> - Specifies the value must be equal to the supplied value. The
default error message for this option is <em>"must be equal to %{count}"</em>.</li>
<li><code>:less_than</code> - Specifies the value must be less than the supplied value. The
default error message for this option is <em>"must be less than %{count}"</em>.</li>
<li><code>:less_than_or_equal_to</code> - Specifies the value must be less than or equal to
the supplied value. The default error message for this option is <em>"must be
less than or equal to %{count}"</em>.</li>
<li><code>:other_than</code> - Specifies the value must be other than the supplied value.
The default error message for this option is <em>"must be other than %{count}"</em>.</li>
</ul>
<div class="note"><p>The validator requires a compare option be supplied. Each option accepts a
value, proc, or symbol. Any class that includes Comparable can be compared.</p></div><h3 id="format"><a class="anchorlink" href="#format">2.4 <code>format</code></a></h3><p>This helper validates the attributes' values by testing whether they match a
given regular expression, which is specified using the <code>:with</code> option.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:legacy_code</span><span class="p">,</span> <span class="ss">format: </span><span class="p">{</span> <span class="ss">with: </span><span class="sr">/\A[a-zA-Z]+\z/</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"only allows letters"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Product < ApplicationRecord
  validates :legacy_code, format: { with: /\A[a-zA-Z]+\z/,
    message: &quot;only allows letters&quot; }
end
">Copy</button>
</div>
<p>Inversely, by using the <code>:without</code> option instead you can require that the
specified attribute does <em>not</em> match the regular expression.</p><p>In either case, the provided <code>:with</code> or <code>:without</code> option must be a regular
expression or a proc or lambda that return one.</p><p>The default error message is <em>"is invalid"</em>.</p><div class="warning"><p>use <code>\A</code> and <code>\z</code> to match the start and end of the string, <code>^</code> and <code>$</code>
match the start/end of a line. Due to frequent misuse of <code>^</code> and <code>$</code>, you need
to pass the <code>multiline: true</code> option in case you use any of these two anchors in
the provided regular expression. In most cases, you should be using <code>\A</code> and
<code>\z</code>.</p></div><h3 id="inclusion"><a class="anchorlink" href="#inclusion">2.5 <code>inclusion</code></a></h3><p>This helper validates that the attributes' values are included in a given set.
In fact, this set can be any enumerable object.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Coffee</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="sx">%w(small medium large)</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"%{value} is not a valid size"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Coffee < ApplicationRecord
  validates :size, inclusion: { in: %w(small medium large),
    message: &quot;%{value} is not a valid size&quot; }
end
">Copy</button>
</div>
<p>The <code>inclusion</code> helper has an option <code>:in</code> that receives the set of values that
will be accepted. The <code>:in</code> option has an alias called <code>:within</code> that you can
use for the same purpose, if you'd like to. The previous example uses the
<code>:message</code> option to show how you can include the attribute's value. For full
options please see the <a href="#message">message documentation</a>.</p><p>The default error message for this helper is <em>"is not included in the list"</em>.</p><h3 id="exclusion"><a class="anchorlink" href="#exclusion">2.6 <code>exclusion</code></a></h3><p>The opposite of <code>inclusion</code> is... <code>exclusion</code>!</p><p>This helper validates that the attributes' values are not included in a given
set. In fact, this set can be any enumerable object.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:subdomain</span><span class="p">,</span> <span class="ss">exclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="sx">%w(www us ca jp)</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"%{value} is reserved."</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account < ApplicationRecord
  validates :subdomain, exclusion: { in: %w(www us ca jp),
    message: &quot;%{value} is reserved.&quot; }
end
">Copy</button>
</div>
<p>The <code>exclusion</code> helper has an option <code>:in</code> that receives the set of values that
will not be accepted for the validated attributes. The <code>:in</code> option has an
alias called <code>:within</code> that you can use for the same purpose, if you'd like to.
This example uses the <code>:message</code> option to show how you can include the
attribute's value. For full options to the message argument please see the
<a href="#message">message documentation</a>.</p><p>The default error message is <em>"is reserved"</em>.</p><p>Alternatively to a traditional enumerable (like an Array), you can supply a
proc, lambda, or symbol which returns an enumerable. If the enumerable is a
numerical, time, or datetime range the test is performed with <code>Range#cover?</code>,
otherwise with <code>include?</code>. When using a proc or lambda the instance under
validation is passed as an argument.</p><h3 id="length"><a class="anchorlink" href="#length">2.7 <code>length</code></a></h3><p>This helper validates the length of the attributes' values. It provides a
variety of options, so you can specify length constraints in different ways:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">2</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:bio</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">500</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">in: </span><span class="mi">6</span><span class="o">..</span><span class="mi">20</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:registration_number</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">is: </span><span class="mi">6</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, length: { minimum: 2 }
  validates :bio, length: { maximum: 500 }
  validates :password, length: { in: 6..20 }
  validates :registration_number, length: { is: 6 }
end
">Copy</button>
</div>
<p>The possible length constraint options are:</p>
<ul>
<li><code>:minimum</code> - The attribute cannot have less than the specified length.</li>
<li><code>:maximum</code> - The attribute cannot have more than the specified length.</li>
<li><code>:in</code> (or <code>:within</code>) - The attribute length must be included in a given
interval. The value for this option must be a range.</li>
<li><code>:is</code> - The attribute length must be equal to the given value.</li>
</ul>
<p>The default error messages depend on the type of length validation being
performed. You can customize these messages using the <code>:wrong_length</code>,
<code>:too_long</code>, and <code>:too_short</code> options and <code>%{count}</code> as a placeholder for the
number corresponding to the length constraint being used. You can still use the
<code>:message</code> option to specify an error message.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:bio</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">maximum: </span><span class="mi">1000</span><span class="p">,</span>
    <span class="ss">too_long: </span><span class="s2">"%{count} characters is the maximum allowed"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :bio, length: { maximum: 1000,
    too_long: &quot;%{count} characters is the maximum allowed&quot; }
end
">Copy</button>
</div>
<p>Note that the default error messages are plural (e.g., "is too short (minimum
is %{count} characters)"). For this reason, when <code>:minimum</code> is 1 you should
provide a custom message or use <code>presence: true</code> instead. When
<code>:in</code> or <code>:within</code> have a lower limit of 1, you should either provide a
custom message or call <code>presence</code> prior to <code>length</code>.</p><div class="note"><p>Only one constraint option can be used at a time apart from the <code>:minimum</code>
and <code>:maximum</code> options which can be combined together.</p></div><h3 id="numericality"><a class="anchorlink" href="#numericality">2.8 <code>numericality</code></a></h3><p>This helper validates that your attributes have only numeric values. By
default, it will match an optional sign followed by an integer or floating
point number.</p><p>To specify that only integer numbers are allowed, set <code>:only_integer</code> to true.
Then it will use the following regular expression to validate the attribute's
value.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sr">/\A[+-]?\d+\z/</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="/\A[+-]?\d+\z/
">Copy</button>
</div>
<p>Otherwise, it will try to convert the value to a number using <code>Float</code>. <code>Float</code>s
are cast to <code>BigDecimal</code> using the column's precision value or a maximum of 15
digits.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Player</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:points</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:games_played</span><span class="p">,</span> <span class="ss">numericality: </span><span class="p">{</span> <span class="ss">only_integer: </span><span class="kp">true</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Player < ApplicationRecord
  validates :points, numericality: true
  validates :games_played, numericality: { only_integer: true }
end
">Copy</button>
</div>
<p>The default error message for <code>:only_integer</code> is <em>"must be an integer"</em>.</p><p>Besides <code>:only_integer</code>, this helper also accepts the <code>:only_numeric</code> option
which specifies the value must be an instance of <code>Numeric</code> and attempts to parse
the value if it is a <code>String</code>.</p><div class="note"><p>By default, <code>numericality</code> doesn't allow <code>nil</code> values. You can use
<code>allow_nil: true</code> option to permit it. Notice that for <code>Integer</code> and <code>Float</code>
columns empty strings are converted to <code>nil</code>.</p></div><p>The default error message when no options are specified is <em>"is not a number"</em>.</p><p>There are also many options that can be used to add constraints to acceptable
values:</p>
<ul>
<li><code>:greater_than</code> - Specifies the value must be greater than the supplied
value. The default error message for this option is <em>"must be greater than
%{count}"</em>.</li>
<li><code>:greater_than_or_equal_to</code> - Specifies the value must be greater than or
equal to the supplied value. The default error message for this option is
<em>"must be greater than or equal to %{count}"</em>.</li>
<li><code>:equal_to</code> - Specifies the value must be equal to the supplied value. The
default error message for this option is <em>"must be equal to %{count}"</em>.</li>
<li><code>:less_than</code> - Specifies the value must be less than the supplied value. The
default error message for this option is <em>"must be less than %{count}"</em>.</li>
<li><code>:less_than_or_equal_to</code> - Specifies the value must be less than or equal to
the supplied value. The default error message for this option is <em>"must be
less than or equal to %{count}"</em>.</li>
<li><code>:other_than</code> - Specifies the value must be other than the supplied value.
The default error message for this option is <em>"must be other than %{count}"</em>.</li>
<li><code>:in</code> - Specifies the value must be in the supplied range.
The default error message for this option is <em>"must be in %{count}"</em>.</li>
<li><code>:odd</code> - Specifies the value must be an odd number. The default error message
for this option is <em>"must be odd"</em>.</li>
<li><code>:even</code> - Specifies the value must be an even number. The default error
message for this option is <em>"must be even"</em>.</li>
</ul>
<h3 id="presence"><a class="anchorlink" href="#presence">2.9 <code>presence</code></a></h3><p>This helper validates that the specified attributes are not empty. It uses the
<a href="https://edgeapi.rubyonrails.org/classes/Object.html#method-i-blank-3F"><code>Object#blank?</code></a> method to check if the value is either <code>nil</code> or a blank
string, that is, a string that is either empty or consists of whitespace.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, :login, :email, presence: true
end
">Copy</button>
</div>
<p>If you want to be sure that an association is present, you'll need to test
whether the associated object itself is present, and not the foreign key used
to map the association. This way, it is not only checked that the foreign key
is not empty but also that the referenced object exists.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Supplier</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:account</span>
  <span class="n">validates</span> <span class="ss">:account</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Supplier < ApplicationRecord
  has_one :account
  validates :account, presence: true
end
">Copy</button>
</div>
<p>In order to validate associated records whose presence is required, you must
specify the <code>:inverse_of</code> option for the association:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:line_items</span><span class="p">,</span> <span class="ss">inverse_of: :order</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Order < ApplicationRecord
  has_many :line_items, inverse_of: :order
end
">Copy</button>
</div>
<div class="note"><p>If you want to ensure that the association it is both present and valid,
you also need to use <code>validates_associated</code>. More on that
<a href="#validates-associated">below</a></p></div><p>If you validate the presence of an object associated via a <code>has_one</code> or
<code>has_many</code> relationship, it will check that the object is neither <code>blank?</code> nor
<code>marked_for_destruction?</code>.</p><p>Since <code>false.blank?</code> is true, if you want to validate the presence of a boolean
field you should use one of the following validations:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># Value _must_ be true or false</span>
<span class="n">validates</span> <span class="ss">:boolean_field_name</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">]</span>
<span class="c1"># Value _must not_ be nil, aka true or false</span>
<span class="n">validates</span> <span class="ss">:boolean_field_name</span><span class="p">,</span> <span class="ss">exclusion: </span><span class="p">[</span><span class="kp">nil</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# Value _must_ be true or false
validates :boolean_field_name, inclusion: [true, false]
# Value _must not_ be nil, aka true or false
validates :boolean_field_name, exclusion: [nil]
">Copy</button>
</div>
<p>By using one of these validations, you will ensure the value will NOT be <code>nil</code>
which would result in a <code>NULL</code> value in most cases.</p><p>The default error message is <em>"can't be blank"</em>.</p><h3 id="absence"><a class="anchorlink" href="#absence">2.10 <code>absence</code></a></h3><p>This helper validates that the specified attributes are absent. It uses the
<a href="https://edgeapi.rubyonrails.org/classes/Object.html#method-i-present-3F"><code>Object#present?</code></a> method to check if the value is not either nil or a blank
string, that is, a string that is either empty or consists of whitespace.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">absence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, :login, :email, absence: true
end
">Copy</button>
</div>
<p>If you want to be sure that an association is absent, you'll need to test
whether the associated object itself is absent, and not the foreign key used
to map the association.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">LineItem</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:order</span>
  <span class="n">validates</span> <span class="ss">:order</span><span class="p">,</span> <span class="ss">absence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class LineItem < ApplicationRecord
  belongs_to :order
  validates :order, absence: true
end
">Copy</button>
</div>
<p>In order to validate associated records whose absence is required, you must
specify the <code>:inverse_of</code> option for the association:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:line_items</span><span class="p">,</span> <span class="ss">inverse_of: :order</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Order < ApplicationRecord
  has_many :line_items, inverse_of: :order
end
">Copy</button>
</div>
<div class="note"><p>If you want to ensure that the association it is both present and valid,
you also need to use <code>validates_associated</code>. More on that
<a href="#validates-associated">below</a></p></div><p>If you validate the absence of an object associated via a <code>has_one</code> or
<code>has_many</code> relationship, it will check that the object is neither <code>present?</code> nor
<code>marked_for_destruction?</code>.</p><p>Since <code>false.present?</code> is false, if you want to validate the absence of a boolean
field you should use <code>validates :field_name, exclusion: { in: [true, false] }</code>.</p><p>The default error message is <em>"must be blank"</em>.</p><h3 id="uniqueness"><a class="anchorlink" href="#uniqueness">2.11 <code>uniqueness</code></a></h3><p>This helper validates that the attribute's value is unique right before the
object gets saved.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account < ApplicationRecord
  validates :email, uniqueness: true
end
">Copy</button>
</div>
<p>The validation happens by performing an SQL query into the model's table,
searching for an existing record with the same value in that attribute.</p><p>There is a <code>:scope</code> option that you can use to specify one or more attributes that
are used to limit the uniqueness check:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Holiday</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="p">{</span> <span class="ss">scope: :year</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"should happen once per year"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Holiday < ApplicationRecord
  validates :name, uniqueness: { scope: :year,
    message: &quot;should happen once per year&quot; }
end
">Copy</button>
</div>
<div class="warning"><p>This validation does not create a uniqueness constraint in the
database, so it may happen that two different database connections create two
records with the same value for a column that you intend to be unique. To avoid
that, you must create a unique index on that column in your database.</p></div><p>In order to add a uniqueness database constraint on your database, use the
<a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_index"><code>add_index</code></a> statement in a migration and include the <code>unique: true</code> option.</p><p>Should you wish to create a database constraint to prevent possible violations
of a uniqueness validation using the <code>:scope</code> option, you must create a unique
index on both columns in your database. See <a href="https://dev.mysql.com/doc/refman/en/multiple-column-indexes.html">the MySQL manual</a> for more
details about multiple column indexes or <a href="https://www.postgresql.org/docs/current/static/ddl-constraints.html">the PostgreSQL manual</a> for examples
of unique constraints that refer to a group of columns.</p><p>There is also a <code>:case_sensitive</code> option that you can use to define whether the
uniqueness constraint will be case sensitive, case insensitive, or if it should
respect the default database collation. This option defaults to respecting the
default database collation.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="p">{</span> <span class="ss">case_sensitive: </span><span class="kp">false</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, uniqueness: { case_sensitive: false }
end
">Copy</button>
</div>
<div class="warning"><p>Note that some databases are configured to perform case-insensitive
searches anyway.</p></div><p>There is a <code>:conditions</code> option that you can specify additional conditions as a
<code>WHERE</code> SQL fragment to limit the uniqueness constraint lookup (e.g.
<code>conditions: -&gt; { where(status: 'active') }</code>).</p><p>The default error message is <em>"has already been taken"</em>.</p><p>See <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_uniqueness_of"><code>validates_uniqueness_of</code></a> for more information.</p><h3 id="validates-associated"><a class="anchorlink" href="#validates-associated">2.12 <code>validates_associated</code></a></h3><p>You should use this helper when your model has associations that always need to
be validated. Every time you try to save your object, <code>valid?</code> will be called
on each one of the associated objects.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Library</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:books</span>
  <span class="n">validates_associated</span> <span class="ss">:books</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Library < ApplicationRecord
  has_many :books
  validates_associated :books
end
">Copy</button>
</div>
<p>This validation will work with all of the association types.</p><div class="warning"><p>Don't use <code>validates_associated</code> on both ends of your associations.
They would call each other in an infinite loop.</p></div><p>The default error message for <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_associated"><code>validates_associated</code></a> is <em>"is invalid"</em>. Note
that each associated object will contain its own <code>errors</code> collection; errors do
not bubble up to the calling model.</p><div class="note"><p><a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_associated"><code>validates_associated</code></a> can only be used with ActiveRecord objects,
everything up until now can also be used on any object which includes
<a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations.html"><code>ActiveModel::Validations</code></a>.</p></div><h3 id="validates-each"><a class="anchorlink" href="#validates-each">2.13 <code>validates_each</code></a></h3><p>This helper validates attributes against a block. It doesn't have a predefined
validation function. You should create one using a block, and every attribute
passed to <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates_each"><code>validates_each</code></a> will be tested against it.</p><p>In the following example, we will reject names and surnames that begin with
lower case.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_each</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:surname</span> <span class="k">do</span> <span class="o">|</span><span class="n">record</span><span class="p">,</span> <span class="kp">attr</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
    <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="kp">attr</span><span class="p">,</span> <span class="s1">'must start with upper case'</span><span class="p">)</span> <span class="k">if</span> <span class="sr">/\A[[:lower:]]/</span><span class="p">.</span><span class="nf">match?</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates_each :name, :surname do |record, attr, value|
    record.errors.add(attr, 'must start with upper case') if /\A[[:lower:]]/.match?(value)
  end
end
">Copy</button>
</div>
<p>The block receives the record, the attribute's name, and the attribute's value.</p><p>You can do anything you like to check for valid data within the block. If your
validation fails, you should add an error to the model, therefore making it
invalid.</p><h3 id="validates-with"><a class="anchorlink" href="#validates-with">2.14 <code>validates_with</code></a></h3><p>This helper passes the record to a separate class for validation.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">GoodnessValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validator</span>
  <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">first_name</span> <span class="o">==</span> <span class="s2">"Evil"</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:base</span><span class="p">,</span> <span class="s2">"This person is evil"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">GoodnessValidator</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class GoodnessValidator < ActiveModel::Validator
  def validate(record)
    if record.first_name == &quot;Evil&quot;
      record.errors.add :base, &quot;This person is evil&quot;
    end
  end
end

class Person < ApplicationRecord
  validates_with GoodnessValidator
end
">Copy</button>
</div>
<p>There is no default error message for <code>validates_with</code>. You must manually add
errors to the record's errors collection in the validator class.</p><div class="note"><p>Errors added to <code>record.errors[:base]</code> relate to the state of the record
as a whole.</p></div><p>To implement the validate method, you must accept a <code>record</code> parameter in the
method definition, which is the record to be validated.</p><p>If you want to add an error on a specific attribute, pass it as the first
argument, such as <code>record.errors.add(:first_name, "please choose another
name")</code>. We will cover <a href="#working-with-validation-errors">validation errors</a> in greater detail later.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="nf">some_field</span> <span class="o">!=</span> <span class="s2">"acceptable"</span>
    <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:some_field</span><span class="p">,</span> <span class="s2">"this field is unacceptable"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def validate(record)
  if record.some_field != &quot;acceptable&quot;
    record.errors.add :some_field, &quot;this field is unacceptable&quot;
  end
end
">Copy</button>
</div>
<p>The <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates_with"><code>validates_with</code></a> helper takes a class, or a list of classes to use for
validation.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">MyValidator</span><span class="p">,</span> <span class="no">MyOtherValidator</span><span class="p">,</span> <span class="ss">on: :create</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates_with MyValidator, MyOtherValidator, on: :create
end
">Copy</button>
</div>
<p>Like all other validations, <code>validates_with</code> takes the <code>:if</code>, <code>:unless</code> and
<code>:on</code> options. If you pass any other options, it will send those options to the
validator class as <code>options</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">GoodnessValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validator</span>
  <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:fields</span><span class="p">].</span><span class="nf">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span> <span class="n">record</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"Evil"</span> <span class="p">}</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:base</span><span class="p">,</span> <span class="s2">"This person is evil"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">GoodnessValidator</span><span class="p">,</span> <span class="ss">fields: </span><span class="p">[</span><span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span><span class="p">]</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class GoodnessValidator < ActiveModel::Validator
  def validate(record)
    if options[:fields].any? { |field| record.send(field) == &quot;Evil&quot; }
      record.errors.add :base, &quot;This person is evil&quot;
    end
  end
end

class Person < ApplicationRecord
  validates_with GoodnessValidator, fields: [:first_name, :last_name]
end
">Copy</button>
</div>
<p>Note that the validator will be initialized <em>only once</em> for the whole application
life cycle, and not on each validation run, so be careful about using instance
variables inside it.</p><p>If your validator is complex enough that you want instance variables, you can
easily use a plain old Ruby object instead:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="no">GoodnessValidator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">person</span><span class="p">).</span><span class="nf">validate</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">GoodnessValidator</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="vi">@person</span> <span class="o">=</span> <span class="n">person</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">validate</span>
    <span class="k">if</span> <span class="n">some_complex_condition_involving_ivars_and_private_methods?</span>
      <span class="vi">@person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:base</span><span class="p">,</span> <span class="s2">"This person is evil"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validate do |person|
    GoodnessValidator.new(person).validate
  end
end

class GoodnessValidator
  def initialize(person)
    @person = person
  end

  def validate
    if some_complex_condition_involving_ivars_and_private_methods?
      @person.errors.add :base, &quot;This person is evil&quot;
    end
  end

  # ...
end
">Copy</button>
</div>
<p>We will cover <a href="#performing-custom-validations">custom validations</a> more later.</p><h2 id="common-validation-options"><a class="anchorlink" href="#common-validation-options">3 Common Validation Options</a></h2><p>There are several common options supported by the validators we just went over,
let's go over some of them now!</p><div class="note"><p>Not all of these options are supported by every validator, please refer to
the API documentation for <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations.html"><code>ActiveModel::Validations</code></a>.</p></div><p>By using any of the validation methods we just mentioned, there also is a list
of common options shared along with validators. We will cover these now!</p>
<ul>
<li><a href="#allow-nil"><code>:allow_nil</code></a>: Skip validation if the attribute is <code>nil</code>.</li>
<li><a href="#allow-blank"><code>:allow_blank</code></a>: Skip validation if the attribute is blank.</li>
<li><a href="#message"><code>:message</code></a>: Specify a custom error message.</li>
<li><a href="#on"><code>:on</code></a>: Specify the contexts where this validation is active.</li>
<li><a href="#strict-validations"><code>:strict</code></a>: Raise an exception when the validation
fails.</li>
<li><a href="#conditional-validation"><code>:if</code> and <code>:unless</code></a>: Specify when the validation
should or should not occur.</li>
</ul>
<h3 id="allow-nil"><a class="anchorlink" href="#allow-nil">3.1 <code>:allow_nil</code></a></h3><p>The <code>:allow_nil</code> option skips the validation when the value being validated is
<code>nil</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Coffee</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="sx">%w(small medium large)</span><span class="p">,</span>
    <span class="ss">message: </span><span class="s2">"%{value} is not a valid size"</span> <span class="p">},</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Coffee < ApplicationRecord
  validates :size, inclusion: { in: %w(small medium large),
    message: &quot;%{value} is not a valid size&quot; }, allow_nil: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Coffee</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">size: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Coffee</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">size: </span><span class="s2">"mega"</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Coffee.create(size: nil).valid?
Coffee.create(size: &quot;mega&quot;).valid?
">Copy</button>
</div>
<p>For full options to the message argument please see the
<a href="#message">message documentation</a>.</p><h3 id="allow-blank"><a class="anchorlink" href="#allow-blank">3.2 <code>:allow_blank</code></a></h3><p>The <code>:allow_blank</code> option is similar to the <code>:allow_nil</code> option. This option
will let validation pass if the attribute's value is <code>blank?</code>, like <code>nil</code> or an
empty string for example.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Topic</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">is: </span><span class="mi">5</span> <span class="p">},</span> <span class="ss">allow_blank: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Topic < ApplicationRecord
  validates :title, length: { is: 5 }, allow_blank: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Topic</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">""</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Topic</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="kp">nil</span><span class="p">).</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Topic.create(title: &quot;&quot;).valid?
Topic.create(title: nil).valid?
">Copy</button>
</div>
<h3 id="message"><a class="anchorlink" href="#message">3.3 <code>:message</code></a></h3><p>As you've already seen, the <code>:message</code> option lets you specify the message that
will be added to the <code>errors</code> collection when validation fails. When this
option is not used, Active Record will use the respective default error message
for each validation helper.</p><p>The <code>:message</code> option accepts either a <code>String</code> or <code>Proc</code> as its value.</p><p>A <code>String</code> <code>:message</code> value can optionally contain any/all of <code>%{value}</code>,
<code>%{attribute}</code>, and <code>%{model}</code> which will be dynamically replaced when
validation fails. This replacement is done using the i18n gem, and the
placeholders must match exactly, no spaces are allowed.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># Hard-coded message</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="p">{</span> <span class="ss">message: </span><span class="s2">"must be given please"</span> <span class="p">}</span>

  <span class="c1"># Message with dynamic attribute value. %{value} will be replaced</span>
  <span class="c1"># with the actual value of the attribute. %{attribute} and %{model}</span>
  <span class="c1"># are also available.</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="p">{</span> <span class="ss">message: </span><span class="s2">"%{value} seems wrong"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  # Hard-coded message
  validates :name, presence: { message: &quot;must be given please&quot; }

  # Message with dynamic attribute value. %{value} will be replaced
  # with the actual value of the attribute. %{attribute} and %{model}
  # are also available.
  validates :age, numericality: { message: &quot;%{value} seems wrong&quot; }
end
">Copy</button>
</div>
<p>A <code>Proc</code> <code>:message</code> value is given two arguments: the object being validated, and
a hash with <code>:model</code>, <code>:attribute</code>, and <code>:value</code> key-value pairs.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span>
    <span class="ss">uniqueness: </span><span class="p">{</span>
      <span class="c1"># object = person object being validated</span>
      <span class="c1"># data = { model: "Person", attribute: "Username", value: &lt;username&gt; }</span>
      <span class="ss">message: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="k">do</span>
        <span class="s2">"Hey </span><span class="si">#{</span><span class="n">object</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">data</span><span class="p">[</span><span class="ss">:value</span><span class="p">]</span><span class="si">}</span><span class="s2"> is already taken."</span>
      <span class="k">end</span>
    <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :username,
    uniqueness: {
      # object = person object being validated
      # data = { model: &quot;Person&quot;, attribute: &quot;Username&quot;, value: <username> }
      message: ->(object, data) do
        &quot;Hey #{object.name}, #{data[:value]} is already taken.&quot;
      end
    }
end
">Copy</button>
</div>
<h3 id="on"><a class="anchorlink" href="#on">3.4 <code>:on</code></a></h3><p>The <code>:on</code> option lets you specify when the validation should happen. The
default behavior for all the built-in validation helpers is to be run on save
(both when you're creating a new record and when you're updating it). If you
want to change it, you can use <code>on: :create</code> to run the validation only when a
new record is created or <code>on: :update</code> to run the validation only when a record
is updated.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># it will be possible to update email with a duplicated value</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :create</span>

  <span class="c1"># it will be possible to create the record with a non-numerical age</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :update</span>

  <span class="c1"># the default (validates on both create and update)</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  # it will be possible to update email with a duplicated value
  validates :email, uniqueness: true, on: :create

  # it will be possible to create the record with a non-numerical age
  validates :age, numericality: true, on: :update

  # the default (validates on both create and update)
  validates :name, presence: true
end
">Copy</button>
</div>
<p>You can also use <code>on:</code> to define custom contexts. Custom contexts need to be
triggered explicitly by passing the name of the context to <code>valid?</code>,
<code>invalid?</code>, or <code>save</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :email, uniqueness: true, on: :account_setup
  validates :age, numericality: true, on: :account_setup
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">age: </span><span class="s1">'thirty-three'</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:account_setup</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:email</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"has already been taken"</span><span class="p">],</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"is not a number"</span><span class="p">]}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new(age: 'thirty-three')
person.valid?
person.valid?(:account_setup)
person.errors.messages
">Copy</button>
</div>
<p><code>person.valid?(:account_setup)</code> executes both the validations without saving
the model. <code>person.save(context: :account_setup)</code> validates <code>person</code> in the
<code>account_setup</code> context before saving.</p><p>Passing an array of symbols is also acceptable.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: </span><span class="p">[</span><span class="ss">:update</span><span class="p">,</span> <span class="ss">:ensure_title</span><span class="p">]</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Book
  include ActiveModel::Validations

  validates :title, presence: true, on: [:update, :ensure_title]
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="kp">nil</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:ensure_title</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:title</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">]}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="book = Book.new(title: nil)
book.valid?
book.valid?(:ensure_title)
book.errors.messages
">Copy</button>
</div>
<p>When triggered by an explicit context, validations are run for that context,
as well as any validations <em>without</em> a context.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">numericality: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :account_setup</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :email, uniqueness: true, on: :account_setup
  validates :age, numericality: true, on: :account_setup
  validates :name, presence: true
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span><span class="p">(</span><span class="ss">:account_setup</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:email</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"has already been taken"</span><span class="p">],</span> <span class="ss">:age</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"is not a number"</span><span class="p">],</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">]}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new
person.valid?(:account_setup)
person.errors.messages
">Copy</button>
</div>
<p>We will cover more use-cases for <code>on:</code> in the <a href="active_record_callbacks.html">callbacks guide</a>.</p><h2 id="strict-validations"><a class="anchorlink" href="#strict-validations">4 Strict Validations</a></h2><p>You can also specify validations to be strict and raise
<code>ActiveModel::StrictValidationFailed</code> when the object is invalid.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="p">{</span> <span class="ss">strict: </span><span class="kp">true</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: { strict: true }
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">valid?</span>
<span class="go">ActiveModel::StrictValidationFailed: Name can't be blank
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="Person.new.valid?
">Copy</button>
</div>
<p>There is also the ability to pass a custom exception to the <code>:strict</code> option.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:token</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">strict: </span><span class="no">TokenGenerationException</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :token, presence: true, uniqueness: true, strict: TokenGenerationException
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">valid?</span>
<span class="gr">TokenGenerationException: Token can't be blank
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="Person.new.valid?
">Copy</button>
</div>
<h2 id="conditional-validation"><a class="anchorlink" href="#conditional-validation">5 Conditional Validation</a></h2><p>Sometimes it will make sense to validate an object only when a given predicate
is satisfied. You can do that by using the <code>:if</code> and <code>:unless</code> options, which
can take a symbol, a <code>Proc</code> or an <code>Array</code>. You may use the <code>:if</code> option when you
want to specify when the validation <strong>should</strong> happen. Alternatively, if you
want to specify when the validation <strong>should not</strong> happen, then you may use the
<code>:unless</code> option.</p><h3 id="using-a-symbol-with-if-and-unless"><a class="anchorlink" href="#using-a-symbol-with-if-and-unless">5.1 Using a Symbol with <code>:if</code> and <code>:unless</code></a></h3><p>You can associate the <code>:if</code> and <code>:unless</code> options with a symbol corresponding
to the name of a method that will get called right before validation happens.
This is the most commonly used option.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:card_number</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">if: :paid_with_card?</span>

  <span class="k">def</span> <span class="nf">paid_with_card?</span>
    <span class="n">payment_type</span> <span class="o">==</span> <span class="s2">"card"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Order < ApplicationRecord
  validates :card_number, presence: true, if: :paid_with_card?

  def paid_with_card?
    payment_type == &quot;card&quot;
  end
end
">Copy</button>
</div>
<h3 id="using-a-proc-with-if-and-unless"><a class="anchorlink" href="#using-a-proc-with-if-and-unless">5.2 Using a Proc with <code>:if</code> and <code>:unless</code></a></h3><p>It is possible to associate <code>:if</code> and <code>:unless</code> with a <code>Proc</code> object
which will be called. Using a <code>Proc</code> object gives you the ability to write an
inline condition instead of a separate method. This option is best suited for
one-liners.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">unless: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span><span class="p">.</span><span class="nf">password</span><span class="p">.</span><span class="nf">blank?</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account < ApplicationRecord
  validates :password, confirmation: true,
    unless: Proc.new { |a| a.password.blank? }
end
">Copy</button>
</div>
<p>As <code>lambda</code> is a type of <code>Proc</code>, it can also be used to write inline conditions
taking advantage of the shortened syntax.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">confirmation: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">unless: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="n">password</span><span class="p">.</span><span class="nf">blank?</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="validates :password, confirmation: true, unless: -> { password.blank? }
">Copy</button>
</div>
<h3 id="grouping-conditional-validations"><a class="anchorlink" href="#grouping-conditional-validations">5.3 Grouping Conditional Validations</a></h3><p>Sometimes it is useful to have multiple validations use one condition. It can
be easily achieved using <a href="https://edgeapi.rubyonrails.org/classes/Object.html#method-i-with_options"><code>with_options</code></a>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">with_options</span> <span class="ss">if: :is_admin?</span> <span class="k">do</span> <span class="o">|</span><span class="n">admin</span><span class="o">|</span>
    <span class="n">admin</span><span class="p">.</span><span class="nf">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
    <span class="n">admin</span><span class="p">.</span><span class="nf">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User < ApplicationRecord
  with_options if: :is_admin? do |admin|
    admin.validates :password, length: { minimum: 10 }
    admin.validates :email, presence: true
  end
end
">Copy</button>
</div>
<p>All validations inside of the <code>with_options</code> block will have automatically
passed the condition <code>if: :is_admin?</code></p><h3 id="combining-validation-conditions"><a class="anchorlink" href="#combining-validation-conditions">5.4 Combining Validation Conditions</a></h3><p>On the other hand, when multiple conditions define whether or not a validation
should happen, an <code>Array</code> can be used. Moreover, you can apply both <code>:if</code> and
<code>:unless</code> to the same validation.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Computer</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:mouse</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">if: </span><span class="p">[</span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">market</span><span class="p">.</span><span class="nf">retail?</span> <span class="p">},</span> <span class="ss">:desktop?</span><span class="p">],</span>
                    <span class="ss">unless: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">trackpad</span><span class="p">.</span><span class="nf">present?</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Computer < ApplicationRecord
  validates :mouse, presence: true,
                    if: [Proc.new { |c| c.market.retail? }, :desktop?],
                    unless: Proc.new { |c| c.trackpad.present? }
end
">Copy</button>
</div>
<p>The validation only runs when all the <code>:if</code> conditions and none of the <code>:unless</code>
conditions are evaluated to <code>true</code>.</p><h2 id="performing-custom-validations"><a class="anchorlink" href="#performing-custom-validations">6 Performing Custom Validations</a></h2><p>When the built-in validation helpers are not enough for your needs, you can
write your own validators or validation methods as you prefer.</p><h3 id="custom-validators"><a class="anchorlink" href="#custom-validators">6.1 Custom Validators</a></h3><p>Custom validators are classes that inherit from <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validator.html"><code>ActiveModel::Validator</code></a>.
These classes must implement the <code>validate</code> method which takes a record as an
argument and performs the validation on it. The custom validator is called using
the <code>validates_with</code> method.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MyValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validator</span>
  <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">unless</span> <span class="n">record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">start_with?</span> <span class="s1">'X'</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:name</span><span class="p">,</span> <span class="s2">"Provide a name starting with X, please!"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates_with</span> <span class="no">MyValidator</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MyValidator < ActiveModel::Validator
  def validate(record)
    unless record.name.start_with? 'X'
      record.errors.add :name, &quot;Provide a name starting with X, please!&quot;
    end
  end
end

class Person < ApplicationRecord
  validates_with MyValidator
end
">Copy</button>
</div>
<p>The easiest way to add custom validators for validating individual attributes
is with the convenient <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/EachValidator.html"><code>ActiveModel::EachValidator</code></a>. In this case, the custom
validator class must implement a <code>validate_each</code> method which takes three
arguments: record, attribute, and value. These correspond to the instance, the
attribute to be validated, and the value of the attribute in the passed
instance.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">EmailValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">EachValidator</span>
  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">unless</span> <span class="no">URI</span><span class="o">::</span><span class="no">MailTo</span><span class="o">::</span><span class="no">EMAIL_REGEXP</span><span class="p">.</span><span class="nf">match?</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">add</span> <span class="n">attribute</span><span class="p">,</span> <span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:message</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"is not an email"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">email: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class EmailValidator < ActiveModel::EachValidator
  def validate_each(record, attribute, value)
    unless URI::MailTo::EMAIL_REGEXP.match?(value)
      record.errors.add attribute, (options[:message] || &quot;is not an email&quot;)
    end
  end
end

class Person < ApplicationRecord
  validates :email, presence: true, email: true
end
">Copy</button>
</div>
<p>As shown in the example, you can also combine standard validations with your
own custom validators.</p><h3 id="custom-methods"><a class="anchorlink" href="#custom-methods">6.2 Custom Methods</a></h3><p>You can also create methods that verify the state of your models and add errors
to the <code>errors</code> collection when they are invalid. You must then register these
methods by using the <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validate"><code>validate</code></a> class method, passing in the symbols for the
validation methods' names.</p><p>You can pass more than one symbol for each class method and the respective
validations will be run in the same order as they were registered.</p><p>The <code>valid?</code> method will verify that the <code>errors</code> collection is empty,
so your custom validation methods should add errors to it when you
wish validation to fail:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="ss">:expiration_date_cannot_be_in_the_past</span><span class="p">,</span>
    <span class="ss">:discount_cannot_be_greater_than_total_value</span>

  <span class="k">def</span> <span class="nf">expiration_date_cannot_be_in_the_past</span>
    <span class="k">if</span> <span class="n">expiration_date</span><span class="p">.</span><span class="nf">present?</span> <span class="o">&amp;&amp;</span> <span class="n">expiration_date</span> <span class="o">&lt;</span> <span class="no">Date</span><span class="p">.</span><span class="nf">today</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:expiration_date</span><span class="p">,</span> <span class="s2">"can't be in the past"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">discount_cannot_be_greater_than_total_value</span>
    <span class="k">if</span> <span class="n">discount</span> <span class="o">&gt;</span> <span class="n">total_value</span>
      <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:discount</span><span class="p">,</span> <span class="s2">"can't be greater than total value"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Invoice < ApplicationRecord
  validate :expiration_date_cannot_be_in_the_past,
    :discount_cannot_be_greater_than_total_value

  def expiration_date_cannot_be_in_the_past
    if expiration_date.present? &amp;&amp; expiration_date < Date.today
      errors.add(:expiration_date, &quot;can't be in the past&quot;)
    end
  end

  def discount_cannot_be_greater_than_total_value
    if discount > total_value
      errors.add(:discount, &quot;can't be greater than total value&quot;)
    end
  end
end
">Copy</button>
</div>
<p>By default, such validations will run every time you call <code>valid?</code> or save the
object. But it is also possible to control when to run these custom validations
by giving an <code>:on</code> option to the <code>validate</code> method, with either: <code>:create</code> or
<code>:update</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="ss">:active_customer</span><span class="p">,</span> <span class="ss">on: :create</span>

  <span class="k">def</span> <span class="nf">active_customer</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">:customer_id</span><span class="p">,</span> <span class="s2">"is not active"</span><span class="p">)</span> <span class="k">unless</span> <span class="n">customer</span><span class="p">.</span><span class="nf">active?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Invoice < ApplicationRecord
  validate :active_customer, on: :create

  def active_customer
    errors.add(:customer_id, &quot;is not active&quot;) unless customer.active?
  end
end
">Copy</button>
</div>
<p>See the section above for more details about <a href="#on"><code>:on</code></a>.</p><h3 id="listing-validators"><a class="anchorlink" href="#listing-validators">6.3 Listing Validators</a></h3><p>If you want to find out all of the validators for a given objects, look no
further than <code>validators</code>.</p><p>For example, if we have the following model using a custom validator and a
built-in validator:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">on: :create</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">format: </span><span class="no">URI</span><span class="o">::</span><span class="no">MailTo</span><span class="o">::</span><span class="no">EMAIL_REGEXP</span>
  <span class="n">validates_with</span> <span class="no">MyOtherValidator</span><span class="p">,</span> <span class="ss">strict: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true, on: :create
  validates :email, format: URI::MailTo::EMAIL_REGEXP
  validates_with MyOtherValidator, strict: true
end
">Copy</button>
</div>
<p>We can now use <code>validators</code> on the "Person" model to list all validators, or
even check a specific field using <code>validators_on</code>.</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">validators</span>
<span class="c">#=&gt; [#&lt;ActiveRecord::Validations::PresenceValidator:0x10b2f2158
</span><span class="go">      @attributes=[:name], @options={:on=&gt;:create}&gt;,
</span><span class="c">     #&lt;MyOtherValidatorValidator:0x10b2f17d0
</span><span class="go">      @attributes=[:name], @options={:strict=&gt;true}&gt;,
</span><span class="c">     #&lt;ActiveModel::Validations::FormatValidator:0x10b2f0f10
</span><span class="go">      @attributes=[:email],
      @options={:with=&gt;URI::MailTo::EMAIL_REGEXP}&gt;]
</span><span class="c">     #&lt;MyOtherValidator:0x10b2f0948 @options={:strict=&gt;true}&gt;]
</span><span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">validators_on</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="c">#=&gt; [#&lt;ActiveModel::Validations::PresenceValidator:0x10b2f2158
</span><span class="go">      @attributes=[:name], @options={on: :create}&gt;]
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="Person.validators
Person.validators_on(:name)
">Copy</button>
</div>
<h2 id="working-with-validation-errors"><a class="anchorlink" href="#working-with-validation-errors">7 Working with Validation Errors</a></h2><p>The <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Validations.html#method-i-valid-3F"><code>valid?</code></a> and <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations.html#method-i-invalid-3F"><code>invalid?</code></a> methods only provide a summary status on
validity. However you can dig deeper into each individual error by using various
methods from the <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Validations.html#method-i-errors"><code>errors</code></a> collection.</p><p>The following is a list of the most commonly used methods. Please refer to the
<a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html"><code>ActiveModel::Errors</code></a> documentation for a list of all the available methods.</p><h3 id="working-with-validation-errors-errors"><a class="anchorlink" href="#working-with-validation-errors-errors">7.1 <code>errors</code></a></h3><p>The gateway through which you can drill down into various details of each error.</p><p>This returns an instance of the class <code>ActiveModel::Errors</code> containing all
errors, each error is represented by an <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Error.html"><code>ActiveModel::Error</code></a> object.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true, length: { minimum: 3 }
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"Name can't be blank"</span><span class="p">,</span> <span class="s2">"Name is too short (minimum is 3 characters)"</span><span class="p">]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span>
<span class="p">=&gt;</span> <span class="p">[]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">details</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="o">=&gt;</span><span class="ss">:too_short</span><span class="p">,</span> <span class="ss">:count</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new
person.valid?
person.errors.full_messages
person = Person.new(name: &quot;John Doe&quot;)
person.valid?
person.errors.full_messages
person = Person.new
person.valid?
person.errors.first.details
">Copy</button>
</div>
<h3 id="errors"><a class="anchorlink" href="#errors">7.2 <code>errors[]</code></a></h3><p><a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-5B-5D"><code>errors[]</code></a> is used when you want to check the error
messages for a specific attribute. It returns an array of strings with all error
messages for the given attribute, each string with one error message. If there
are no errors related to the attribute, it returns an empty array.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true, length: { minimum: 3 }
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John Doe"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"JD"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"is too short (minimum is 3 characters)"</span><span class="p">]</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">,</span> <span class="s2">"is too short (minimum is 3 characters)"</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new(name: &quot;John Doe&quot;)
person.valid?
person.errors[:name]
person = Person.new(name: &quot;JD&quot;)
person.valid?
person.errors[:name]
person = Person.new
person.valid?
person.errors[:name]
">Copy</button>
</div>
<h3 id="errors-where-and-error-object"><a class="anchorlink" href="#errors-where-and-error-object">7.3 <code>errors.where</code> and Error Object</a></h3><p>Sometimes we may need more information about each error besides its message.
Each error is encapsulated as an <code>ActiveModel::Error</code> object, and the
<a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-where"><code>where</code></a> method is the most common way of access.</p><p><code>where</code> returns an array of error objects filtered by various degrees of
conditions.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true, length: { minimum: 3 }
end
">Copy</button>
</div>
<p>We can filter for just the <code>attribute</code> by passing it as the first parameter to
<code>errors.where(:attr)</code>. The second parameter is used for filtering the <code>type</code> of
error we want by calling <code>errors.where(:attr, :type)</code>.</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="c1"># all errors for :name attribute</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_short</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="c1"># :too_short errors for :name attribute</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new
person.valid?
person.errors.where(:name)
person.errors.where(:name, :too_short)
">Copy</button>
</div>
<p>Lastly, we can filter by any <code>options</code> that may exist on the given type of error
object.</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_short</span><span class="p">,</span> <span class="ss">minimum: </span><span class="mi">3</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span> <span class="c1"># all name errors being too short and minimum is 2</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new
person.valid?
person.errors.where(:name, :too_short, minimum: 3)
">Copy</button>
</div>
<p>You can read various information from these error objects:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span> <span class="o">=</span> <span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">last</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">attribute</span>
<span class="p">=&gt;</span> <span class="ss">:name</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">type</span>
<span class="p">=&gt;</span> <span class="ss">:too_short</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">options</span><span class="p">[</span><span class="ss">:count</span><span class="p">]</span>
<span class="p">=&gt;</span> <span class="mi">3</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="error = person.errors.where(:name).last
error.attribute
error.type
error.options[:count]
">Copy</button>
</div>
<p>You can also generate the error message:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">message</span>
<span class="p">=&gt;</span> <span class="s2">"is too short (minimum is 3 characters)"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name is too short (minimum is 3 characters)"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="error.message
error.full_message
">Copy</button>
</div>
<p>The <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-full_message"><code>full_message</code></a> method generates a more user-friendly message, with the
capitalized attribute name prepended. (To customize the format that
<code>full_message</code> uses, see the <a href="i18n.html#active-model-methods">I18n guide</a>.)</p><h3 id="errors-add"><a class="anchorlink" href="#errors-add">7.4 <code>errors.add</code></a></h3><p>The <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-add"><code>add</code></a> method creates the error object by taking the <code>attribute</code>, the
error <code>type</code> and additional options hash. This is useful when writing your own
validator, as it lets you define very specific error situations.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:too_plain</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"is not cool enough"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validate do |person|
    errors.add :name, :too_plain, message: &quot;is not cool enough&quot;
  end
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">create</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">type</span>
<span class="p">=&gt;</span> <span class="ss">:too_plain</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"Name is not cool enough"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.create
person.errors.where(:name).first.type
person.errors.where(:name).first.full_message
">Copy</button>
</div>
<h3 id="errors-base"><a class="anchorlink" href="#errors-base">7.5 <code>errors[:base]</code></a></h3><p>You can add errors that are related to the object's state as a whole, instead of
being related to a specific attribute. To do this you must use <code>:base</code> as the
attribute when adding a new error.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validate</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:base</span><span class="p">,</span> <span class="ss">:invalid</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"This person is invalid because ..."</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validate do |person|
    errors.add :base, :invalid, message: &quot;This person is invalid because ...&quot;
  end
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">create</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">:base</span><span class="p">).</span><span class="nf">first</span><span class="p">.</span><span class="nf">full_message</span>
<span class="p">=&gt;</span> <span class="s2">"This person is invalid because ..."</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.create
person.errors.where(:base).first.full_message
">Copy</button>
</div>
<h3 id="errors-size"><a class="anchorlink" href="#errors-size">7.6 <code>errors.size</code></a></h3><p>The <code>size</code> method returns the total number of errors for the object.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true, length: { minimum: 3 }
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">size</span>
<span class="p">=&gt;</span> <span class="mi">2</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Andrea"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"andrea@example.com"</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">size</span>
<span class="p">=&gt;</span> <span class="mi">0</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new
person.valid?
person.errors.size
person = Person.new(name: &quot;Andrea&quot;, email: &quot;andrea@example.com&quot;)
person.valid?
person.errors.size
">Copy</button>
</div>
<h3 id="errors-clear"><a class="anchorlink" href="#errors-clear">7.7 <code>errors.clear</code></a></h3><p>The <code>clear</code> method is used when you intentionally want to clear the <code>errors</code>
collection. Of course, calling <code>errors.clear</code> upon an invalid object won't
actually make it valid: the <code>errors</code> collection will now be empty, but the next
time you call <code>valid?</code> or any method that tries to save this object to the
database, the validations will run again. If any of the validations fail, the
<code>errors</code> collection will be filled again.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person < ApplicationRecord
  validates :name, presence: true, length: { minimum: 3 }
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">empty?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">clear</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">empty?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">save</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">empty?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="person = Person.new
person.valid?
person.errors.empty?
person.errors.clear
person.errors.empty?
person.save
person.errors.empty?
">Copy</button>
</div>
<h2 id="displaying-validation-errors-in-views"><a class="anchorlink" href="#displaying-validation-errors-in-views">8 Displaying Validation Errors in Views</a></h2><p>Once you've created a model and added validations, if that model is created via
a web form, you probably want to display an error message when one of the
validations fails.</p><p>Because every application handles this kind of thing differently, Rails does
not include any view helpers to help you generate these messages directly.
However, due to the rich number of methods Rails gives you to interact with
validations in general, you can build your own. In addition, when
generating a scaffold, Rails will put some ERB into the <code>_form.html.erb</code> that
it generates that displays the full list of errors on that model.</p><p>Assuming we have a model that's been saved in an instance variable named
<code>@article</code>, it looks like this:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span> prohibited this article from being saved:<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;ul&gt;</span>
      <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">error</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">error</span><span class="p">.</span><span class="nf">full_message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="<% if @article.errors.any? %>
  <div id=&quot;error_explanation&quot;>
    <h2><%= pluralize(@article.errors.count, &quot;error&quot;) %> prohibited this article from being saved:</h2>

    <ul>
      <% @article.errors.each do |error| %>
        <li><%= error.full_message %></li>
      <% end %>
    </ul>
  </div>
<% end %>
">Copy</button>
</div>
<p>Furthermore, if you use the Rails form helpers to generate your forms, when
a validation error occurs on a field, it will generate an extra <code>&lt;div&gt;</code> around
the entry.</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field_with_errors"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"article_title"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="<div class=&quot;field_with_errors&quot;>
  <input id=&quot;article_title&quot; name=&quot;article[title]&quot; size=&quot;30&quot; type=&quot;text&quot; value=&quot;&quot;>
</div>
">Copy</button>
</div>
<p>You can then style this div however you'd like. The default scaffold that
Rails generates, for example, adds this CSS rule:</p><div class="code_container">
<pre><code class="highlight css"><span class="nc">.field_with_errors</span> <span class="p">{</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text=".field_with_errors {
  padding: 2px;
  background-color: red;
  display: table;
}
">Copy</button>
</div>
<p>This means that any field with an error ends up with a 2 pixel red border.</p>

        <h3>Feedback</h3>
        <p>
          You're encouraged to help improve the quality of this guide.
        </p>
        <p>
          Please contribute if you see any typos or factual errors.
          To get started, you can read our <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a> section.
        </p>
        <p>
          You may also find incomplete content or stuff that is not up to date.
          Please do add any missing documentation for main. Make sure to check
          <a href="https://edgeguides.rubyonrails.org">Edge Guides</a> first to verify
          if the issues are already fixed or not on the main branch.
          Check the <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a>
          for style and conventions.
        </p>
        <p>
          If for whatever reason you spot something to fix but cannot patch it yourself, please
          <a href="https://github.com/rails/rails/issues">open an issue</a>.
        </p>
        <p>And last but not least, any kind of discussion regarding Ruby on Rails
          documentation is very welcome on the <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">official Ruby on Rails Forum</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a> License</p>
<p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>

    </div>
  </div>
</body>
</html>
